<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Setting up a powerful self-hosted IDE in the cloud - Gerard Braad's blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://gbraad.nl/blog/setting-up-a-powerful-self-hosted-ide-in-the-cloud.html">

        <meta name="author" content="Gerard Braad <me@gbraad.nl>" />
        <meta name="keywords" content="docker,c9ide,fedora" />
        <meta name="description" content="Setting up infrastructure should be as simple as playing with LEGO. With the advent of Docker, IT has underwent a dramatic change. For instance, it became easy to setup throw-away development environments. These could then be used to create clean environments to perform builds in. And eventually, containers are starting ..." />

        <meta property="og:site_name" content="Gerard Braad's blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Setting up a powerful self-hosted IDE in the cloud"/>
        <meta property="og:url" content="http://gbraad.nl/blog/setting-up-a-powerful-self-hosted-ide-in-the-cloud.html"/>
        <meta property="og:description" content="Setting up infrastructure should be as simple as playing with LEGO. With the advent of Docker, IT has underwent a dramatic change. For instance, it became easy to setup throw-away development environments. These could then be used to create clean environments to perform builds in. And eventually, containers are starting ..."/>
        <meta property="article:published_time" content="2016-09-06" />
            <meta property="article:section" content="Containers" />
            <meta property="article:tag" content="docker" />
            <meta property="article:tag" content="c9ide" />
            <meta property="article:tag" content="fedora" />
            <meta property="article:author" content="Gerard Braad <me@gbraad.nl>" />


    <!-- Bootstrap -->
	<link href="//cdn.gbraad.nl/css/bootstrap.css" rel="stylesheet">
	<link href="//cdn.gbraad.nl/css/font-awesome.css" rel="stylesheet">
    <link href="//cdn.gbraad.nl/css/pygments-tomorrownightbright.css" rel="stylesheet">
	<link href="//cdn.gbraad.nl/css/animations.css" rel="stylesheet">
	<link href="//cdn.gbraad.nl/css/style.css" rel="stylesheet">
	<link href="//cdn.gbraad.nl/css/custom.css" rel="stylesheet">

        <link href="http://gbraad.nl/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Gerard Braad's blog ATOM Feed"/>



        <link href="http://gbraad.nl/blog/feeds/containers.atom.xml" type="application/atom+xml" rel="alternate"
              title="Gerard Braad's blog Containers ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://gbraad.nl/blog/" class="navbar-brand">
Gerard Braad's blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://gbraad.nl/blog/category/about-me.html">About me</a>
                        </li>
                        <li >
                            <a href="http://gbraad.nl/blog/category/books.html">Books</a>
                        </li>
                        <li >
                            <a href="http://gbraad.nl/blog/category/ci-cd.html">CI / CD</a>
                        </li>
                        <li class="active">
                            <a href="http://gbraad.nl/blog/category/containers.html">Containers</a>
                        </li>
                        <li >
                            <a href="http://gbraad.nl/blog/category/devops.html">DevOps</a>
                        </li>
                        <li >
                            <a href="http://gbraad.nl/blog/category/high-availability.html">High Availability</a>
                        </li>
                        <li >
                            <a href="http://gbraad.nl/blog/category/javascript.html">JavaScript</a>
                        </li>
                        <li >
                            <a href="http://gbraad.nl/blog/category/misc.html">Misc</a>
                        </li>
                        <li >
                            <a href="http://gbraad.nl/blog/category/openstack.html">OpenStack</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://gbraad.nl/blog/setting-up-a-powerful-self-hosted-ide-in-the-cloud.html"
                       rel="bookmark"
                       title="Permalink to Setting up a powerful self-hosted IDE in the cloud">
                        Setting up a powerful self-hosted IDE in the cloud
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-09-06T00:00:00+08:00"> Tue 06 September 2016</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="http://gbraad.nl/blog/tag/docker.html">docker</a>
        /
	<a href="http://gbraad.nl/blog/tag/c9ide.html">c9ide</a>
        /
	<a href="http://gbraad.nl/blog/tag/fedora.html">fedora</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Setting up infrastructure should be as simple as playing with LEGO. With the advent of Docker, IT has underwent a dramatic change. For instance, it became easy to setup throw-away development environments. These could then be used to create clean environments to perform builds in. And eventually, containers are starting to move into the general infrastructure . This is a transaction that is currently still happening, helped by tools as Docker Swarm and Kubernetes. In this short article I will show how these ideas can help in setting up a composable infrastructure, providing you with a powerful IDE in the cloud, full with Let's Encrypt certificate generation.</p>
<h2>Cloud9</h2>
<p>We will be deploying C9, or Cloud9 IDE, is a full IDE which can be accessed from your browser. For convenience of use, I created a containerized version of this some while back and have ever since been using it. Although,, C9 also has a hosted environment, I grew worried after Amazon acquired the company. Support has since been slower to respond and this made me look into other ways to provide an alternative approach. After some testing with Docker Cloud it seemed like a good idea to deploy a self-hosted alternative.</p>
<p>But first about one of the main components. The <a href="https://hub.docker.com/r/gbraad/c9ide/">container</a> I created exposes port 8181, which is an unsecured endpoint. It allows you to simply setup a local instance with:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">alias</span> <span class="nv">c9ide</span><span class="o">=</span><span class="s1">&#39;docker run -it --rm -v $PWD:/workspace gbraad/c9ide:u1604&#39;</span>
$ <span class="nb">cd</span> ~/Projects/gauth
$ c9ide
</pre></div>


<p>This would however work for a local environment and does not provide a secure solution. More was needed... such as secure solution and preferably automated. For this Nginx and Let's Encrypt is used.  More information about Cloud9 can be found in my Knowledge Base <a href="https://github.com/gbraad/knowledge-base/blob/master/technology/c9ide.md">article</a><a href="https://gitlab.com/gbraad/knowledge-base/blob/master/technology/c9ide.md">*</a>.</p>
<h2>Preparation</h2>
<p>To deploy the environment I used <a href="http://fedoraproject.org">Fedora</a> 24. Most cloud providers provide this as an image. In my case, <a href="https://www.citycloud.com">CityCloud</a> provided the latest version after placing a simple request. You can consider any size, but the more storage and memory, the better the performance will be. I set up a 4G and 2 cores instance, with 50G of storage. After logging in, perform the following commands</p>
<div class="highlight"><pre><span></span>$ sudo su -
$ dnf update -y
$ dnf install -y docker
$ setenforce 0
$ sed <span class="s1">&#39;s/SELINUX=targeted/SELINUX=permisssive/g&#39;</span> /etc/selinux/config
$ systemctl <span class="nb">enable</span> docker
$ systemctl start docker
</pre></div>


<p>Note: SELinux is disabled because we will have a volume attached to the IDE container where the workspace will be located. We can however fix this, but this is something for a future blog post.</p>
<h3>Setup DNS</h3>
<p>After this, you host machine should be ready to host containers to will make up our environment. before we continue, we need to be sure we have DNS configured that can point to the running containers that host the C9 IDE. I used <a href="https://www.cloudflare.com">CloudFlare</a> and setup the following wildcard for my environment. </p>
<p><img alt="" src="https://cdn.gbraad.nl/images/blog/c9ide-dns.png" /></p>
<p>With this each hostname, such as <code>ubuntu.c9ide.spotsnel.net</code> would point to the same machine that hosts our development containers.</p>
<h3>Deploy Nginx</h3>
<p>To allow a hostname to be resolved to a 'local' end-point a reverse proxy is needed. Jason Wilder created a container for this purpose called <code>nginx-proxy</code>. It needs access to the <code>docker.sock</code> to be notified of changes and it will accordingly create an endpoint in the hosted Nginx. For more information about this, please read <a href="https://hub.docker.com/r/jwilder/nginx-proxy/">nginx-proxy</a>'s description on Docker hub.</p>
<div class="highlight"><pre><span></span># docker run -d -p 80:80 -p 443:443 \
   --name nginx-proxy \
   -v /path/to/certs:/etc/nginx/certs:ro \
   -v /etc/nginx/vhost.d \
   -v /usr/share/nginx/html \
   -v /var/run/docker.sock:/tmp/docker.sock:ro \
   jwilder/nginx-proxy
</pre></div>


<p>Opening any address pointing to this host would know result in a 503 error. This means that Nginx is listening and can not forward the request. We will deal with this later.</p>
<h2>Deploy Let's Encrypt companion</h2>
<p>Setting up a secure connection involves certificates which can be quite a hassle to obtain, and if trust of security is concerned, even very expensive. Luckily, initiatives exist that believe security should be available to all and <a href="https://letsencrypt.org">Let's Encrypt</a> provides a fully automated solution. Using the <code>letsencrypt-nginx-proxy-companion</code> container created by Yves Blusseau, it is possible allow the proxy container to be provisioned with the needed certificates. More information about <a href="https://hub.docker.com/r/jrcs/letsencrypt-nginx-proxy-companion/">this container</a> can be found at Docker hub.</p>
<div class="highlight"><pre><span></span># docker run -d \
   --name nginx-proxy-letsencrypt \
   -v /path/to/certs:/etc/nginx/certs:rw \
   --volumes-from nginx-proxy \
   -v /var/run/docker.sock:/var/run/docker.sock:ro \
   jrcs/letsencrypt-nginx-proxy-companion
</pre></div>


<p>Unfortunately we do not have a way to really test this. But if the container starts correctly and does not terminate, it is likely working correctly, waiting for notifications of newly created containers.</p>
<h2>Explanation</h2>
<p>Containers that provide metadata in the form of environment variables, indicate to these service containers what the endpoint will be.</p>
<p>The <code>nginx-proxy</code> service uses <code>VIRTUAL_HOST</code> to know what the hostname endpoint will be. While the Let's Encrypt companion service uses <code>LETSENCRYPT_HOST</code> for this. In the rest of this article the endpoints will be the same. With <code>LETSENCRYPT_EMAIL</code> we indicate to who the certificate will be addressed.</p>
<h2>C9 IDE</h2>
<p>The container hosting C9 is available in different flavors. I have created them based on CentOS 7, Fedora 24 and Ubuntu Xenail (16.04). To prepare, it is a good idea to pull the images locally:</p>
<div class="highlight"><pre><span></span># docker pull gbraad/c9ide:c7
# docker pull gbraad/c9ide:f24
# docker pull gbraad/c9ide:u1604
</pre></div>


<p>To setup the containers as endpoints, I created the following helper script. It will deal with setting up the host and email for login to the container.</p>
<p><code>./create.sh [name] [host] [email] [password] [flavor] [volume]</code></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh -x</span>
<span class="nb">set</span> -e

<span class="nv">NAME</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="s2">&quot;test&quot;</span><span class="si">}</span>
<span class="nv">HOST</span><span class="o">=</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="si">${</span><span class="nv">NAME</span><span class="si">}</span><span class="s2">&quot;.local&quot;</span><span class="si">}</span>
<span class="nv">USER</span><span class="o">=</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="s2">&quot;nobody@local&quot;</span><span class="si">}</span>
<span class="nv">PASS</span><span class="o">=</span><span class="si">${</span><span class="nv">4</span><span class="k">:-</span><span class="s2">&quot;secrete&quot;</span><span class="si">}</span>
<span class="nv">FLAVOR</span><span class="o">=</span><span class="si">${</span><span class="nv">5</span><span class="k">:-</span><span class="s2">&quot;u1604&quot;</span><span class="si">}</span>  <span class="c1"># c7, f24, u1604</span>
<span class="nv">VOLUME</span><span class="o">=</span><span class="si">${</span><span class="nv">6</span><span class="k">:-</span><span class="s2">&quot;/workspaces/c9ide-&quot;</span><span class="si">${</span><span class="nv">NAME</span><span class="si">}}</span>

mkdir -p <span class="si">${</span><span class="nv">VOLUME</span><span class="si">}</span>
docker run -d <span class="se">\</span>
   --name <span class="si">${</span><span class="nv">NAME</span><span class="si">}</span> <span class="se">\</span>
   -v <span class="si">${</span><span class="nv">VOLUME</span><span class="si">}</span>:/workspace:rw <span class="se">\</span>
   -e <span class="s2">&quot;VIRTUAL_HOST=</span><span class="si">${</span><span class="nv">HOST</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
   -e <span class="s2">&quot;LETSENCRYPT_HOST=</span><span class="si">${</span><span class="nv">HOST</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
   -e <span class="s2">&quot;LETSENCRYPT_EMAIL=</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
   -e <span class="s2">&quot;USERNAME=</span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
   -e <span class="s2">&quot;PASSWORD=</span><span class="si">${</span><span class="nv">PASS</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
   gbraad/c9ide:<span class="si">${</span><span class="nv">FLAVOR</span><span class="si">}</span>
</pre></div>
</td></tr></table>

<p>The <code>USERNAME</code> and <code>PASSWORD</code> are used to perform basic authentication.  As you can see, the email address used for the certificates is also used for the username for login. This can of course customized.
 After this, </p>
<div class="highlight"><pre><span></span># chmod +x create.sh
# mkdir /workspaces
# ./create.sh ubuntu ubuntu.c9ide.spotsnel.net me@gbraad.nl verysecrete
# ./create.sh centos quentin.c9ide.spotsnel.net me@quentinyong.nl verysecrete c7
</pre></div>


<p>will create two containers, hosted at <code>ubuntu.c9ide.spotsnel.net</code> and <code>quentin.c9ide.spotsnel.net</code>. Notice that I used <code>/workspaces</code> to provide the storage location for all the host containers. Make sure this is hosted on a separate mountpoint for instance. </p>
<p>Now open your IDE by opening <a href="https://ubuntu.c9ide.spotsnel.net">https://ubuntu.c9ide.spotsnel.net</a> in your browser. If all goes well, you will be created by a login prompt. The username is <code>me@gbraad.nl</code> and the password <code>verysecrete</code>.</p>
<p><img alt="" src="https://cdn.gbraad.nl/images/blog/c9ide-final.png" /></p>
<p>In future articles I will detail more about the composability of infrastructure. if you enjoyed this article, consider tweeting about it. If you have comments, please find me online at <a href="http://twitter.com/gbraad">@gbraad</a>.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'gbraad-blog'; // required: replace example with your forum shortname

                    var disqus_identifier = 'setting-up-a-powerful-self-hosted-ide-in-the-cloud';
                var disqus_url = 'http://gbraad.nl/blog/setting-up-a-powerful-self-hosted-ide-in-the-cloud.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Gerard Braad <me@gbraad.nl>
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://gbraad.nl/blog/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://gbraad.nl/blog/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://gbraad.nl/blog/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'gbraad-blog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-34531495-3']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>